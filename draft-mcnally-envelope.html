<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>The Gordian Envelope Structured Data Format</title>
<meta content="Wolf McNally" name="author">
<meta content="Christopher Allen" name="author">
<meta content='
       Gordian Envelope specifies a structured format for hierarchical binary data focused on the ability to transmit it in a privacy-focused way, offering support for privacy as described in RFC-6973 and human rights as described in RFC-8280. Envelopes are designed to facilitate "smart documents" and have a number of unique features including: easy representation of a variety of semantic structures, a built-in Merkle-like digest tree, deterministic representation using CBOR, and the ability for the holder of a document to selectively elide specific parts of a document without invalidating the digest tree structure. This document specifies the base Envelope format, which is designed to be extensible. 
    ' name="description">
<meta content="xml2rfc 3.17.5" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-mcnally-envelope-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.17.5
    Python 3.11.4
    ConfigArgParse 1.5.3
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.3
    platformdirs 3.10.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.31.0
    setuptools 67.7.2
    six 1.16.0
    wcwidth 0.2.6
-->
<link href="draft-mcnally-envelope.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl > dt {
  float: left;
  margin-right: 1em;
  min-width: 20ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
dl .break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href].selfRef {
  color: var(--text-color);
}
a[href] {
  color: var(--link-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: 14.5px;
}
.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 8em !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([stroke="fill"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Envelope</td>
<td class="right">August 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">McNally &amp; Allen</td>
<td class="center">Expires 17 February 2024</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-mcnally-envelope-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2023-08-16" class="published">16 August 2023</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Experimental</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2024-02-17">17 February 2024</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">W. McNally</div>
<div class="org">Blockchain Commons</div>
</div>
<div class="author">
      <div class="author-name">C. Allen</div>
<div class="org">Blockchain Commons</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">The Gordian Envelope Structured Data Format</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">Gordian Envelope specifies a structured format for hierarchical binary data focused on the ability to transmit it in a privacy-focused way, offering support for privacy as described in RFC-6973 and human rights as described in RFC-8280. Envelopes are designed to facilitate "smart documents" and have a number of unique features including: easy representation of a variety of semantic structures, a built-in Merkle-like digest tree, deterministic representation using CBOR, and the ability for the holder of a document to selectively elide specific parts of a document without invalidating the digest tree structure. This document specifies the base Envelope format, which is designed to be extensible.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/BlockchainCommons/envelope-internet-draft">https://github.com/BlockchainCommons/envelope-internet-draft</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 17 February 2024.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-elision-support" class="internal xref">Elision Support</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-extensions" class="internal xref">Extensions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-envelope-format-specificati" class="internal xref">Envelope Format Specification</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-leaf-case-format" class="internal xref">Leaf Case Format</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-elided-case-format" class="internal xref">Elided Case Format</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-node-case-format" class="internal xref">Node Case Format</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="auto internal xref">3.4</a>.  <a href="#name-assertion-case-format" class="internal xref">Assertion Case Format</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="auto internal xref">3.5</a>.  <a href="#name-wrapped-case-format" class="internal xref">Wrapped Case Format</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-computing-the-digest-tree" class="internal xref">Computing the Digest Tree</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-leaf-digest-calculation" class="internal xref">Leaf Digest Calculation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-elided-digest-calculation" class="internal xref">Elided Digest Calculation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-node-digest-calculation" class="internal xref">Node Digest Calculation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-assertion-digest-calculatio" class="internal xref">Assertion Digest Calculation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-wrapped-digest-calculation" class="internal xref">Wrapped Digest Calculation</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-envelope-hierarchy" class="internal xref">Envelope Hierarchy</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-leaf-case" class="internal xref">Leaf Case</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-elided-case" class="internal xref">Elided Case</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-node-case" class="internal xref">Node Case</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.  <a href="#name-assertion-case" class="internal xref">Assertion Case</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5">
                <p id="section-toc.1-1.5.2.5.1"><a href="#section-5.5" class="auto internal xref">5.5</a>.  <a href="#name-wrapped-case" class="internal xref">Wrapped Case</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-reference-implementations" class="internal xref">Reference Implementations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-cbor-considerations" class="internal xref">CBOR Considerations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-validation-requirements" class="internal xref">Validation Requirements</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-choice-of-sha-256-hash-prim" class="internal xref">Choice of SHA-256 Hash Primitive</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="auto internal xref">7.4</a>.  <a href="#name-correlated-digests" class="internal xref">Correlated Digests</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.5">
                <p id="section-toc.1-1.7.2.5.1"><a href="#section-7.5" class="auto internal xref">7.5</a>.  <a href="#name-rfc-6973-considerations" class="internal xref">RFC-6973 Considerations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.6">
                <p id="section-toc.1-1.7.2.6.1"><a href="#section-7.6" class="auto internal xref">7.6</a>.  <a href="#name-rfc-8280-considerations" class="internal xref">RFC-8280 Considerations</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-cbor-tags" class="internal xref">CBOR Tags</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-media-type" class="internal xref">Media Type</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Gordian Envelope was designed with two key goals in mind: to be <em>Structure-Ready</em>, allowing for the reliable and interoperable encoding and storage of information; and to be <em>Privacy-Ready</em>, ensuring that transmission of that data can occur in a privacy-protecting manner.<a href="#section-1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-2.1">
          <strong>Structure-Ready.</strong> Gordian Envelope is designed as a "smart document": a set of information about a subject. More than that, it's a meta-document that can contain or refer to other documents. It can support multiple data structures, from single data items, to simple hierarchies, to labeled property graphs, semantic triples, and other forms of structured graphs. Though its fundamental structure is a tree, it can be used to create Directed Acyclic Graphs (DAGs) through references within or between Envelopes.<a href="#section-1-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-2.2">
          <strong>Privacy-Ready.</strong> Gordian Envelope protects privacy by affording progressive trust, allowing for holders (not just issuers) to minimally disclose information by using elision, and then to optionally increase that disclosure over time. Progressive trust in Gordian Envelopes is accomplished through the hashing of all elements, which also creates foundational support for signing and encryption. This directly addresses the data minimization suggested by "Privacy Considerations for Internet Protocols" <span>[<a href="#RFC6973" class="cite xref">RFC6973</a>]</span> and also addresses topics such as Privacy, Accessibility, Censorship Resistance, Reliability, and Integrity, which are listed as guidelines in "Research into Human Rights Protocol Considerations" <span>[<a href="#RFC8280" class="cite xref">RFC8280</a>]</span>.<a href="#section-1-2.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-1-3">The following architectural decisions support these goals:<a href="#section-1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-4.1">
          <strong>Structured Merkle Tree.</strong> A variant of the Merkle Tree <span>[<a href="#MERKLE" class="cite xref">MERKLE</a>]</span> structure is created by hashing the elements in the Envelope into a tree of digests. (In this "structured Merkle Tree", all nodes contain both semantic content and digests, rather than semantic content being limited to leaves.)<a href="#section-1-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-4.2">
          <strong>Deterministic Representation.</strong> There is only one way to encode any semantic representation within a Gordian Envelope. This is accomplished through the use of Deterministic CBOR <span>[<a href="#DCBOR" class="cite xref">DCBOR</a>]</span> and the sorting of the Envelope's assertions into a lexicographic order (not to be confused with sorting a CBOR encoding's map keys). Any Envelope that doesn't follow these strict rules will be rejected; as a result, separate actors assembling envelopes from the same information will converge on the same encoded structure.<a href="#section-1-4.2" class="pilcrow">¶</a>
</li>
      </ul>
<div id="elision-support">
<section id="section-1.1">
        <h3 id="name-elision-support">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-elision-support" class="section-name selfRef">Elision Support</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-1.1-1.1">
            <strong>Holder-initiated Elision.</strong> Elision can be performed by the Holder of a Gordian Envelope, not just the Issuer.<a href="#section-1.1-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-1.2">
            <strong>Granular Elision.</strong> Elision can be performed on any data within an Envelope including subjects, predicates and objects of assertions, assertions as a whole, and envelopes as a whole. This allows each entity to elide data as is appropriate for the management of their personal (or business) risk.<a href="#section-1.1-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-1.3">
            <strong>Progressive Trust.</strong> The elision mechanics in Gordian Envelopes allow for progressive trust, where increasing amounts of data may be revealed over time.<a href="#section-1.1-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-1.4">
            <strong>Consistent Hashing.</strong> Even when elided, digests for those parts of the Gordian Envelope remain the same. So constructs such as signatures remain verifiable even for elided documents.<a href="#section-1.1-1.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-1.5">
            <strong>Reversible Elision.</strong> Elision can be reversed by the Holder of a Gordian Envelope, which means removed information can be selectively replaced without changing the digest tree.<a href="#section-1.1-1.5" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="extensions">
<section id="section-1.2">
        <h3 id="name-extensions">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-extensions" class="section-name selfRef">Extensions</a>
        </h3>
<p id="section-1.2-1">This document is the base specification for Gordian Envelope, which is designed to support extension specifications to support constructs like encryption, compression, decorrelation, and inclusion proofs. These extensions will be specified in separate documents.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="terminology">
<section id="section-2">
      <h2 id="name-terminology">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">This specification makes use of the following terminology:<a href="#section-2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2-3">
        <dt id="section-2-3.1">byte</dt>
        <dd style="margin-left: 1.5em" id="section-2-3.2">
          <p id="section-2-3.2.1">Used in its now-customary sense as a synonym for "octet".<a href="#section-2-3.2.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.3">element</dt>
        <dd style="margin-left: 1.5em" id="section-2-3.4">
          <p id="section-2-3.4.1">An envelope is a tree of elements, each of which is itself an envelope.<a href="#section-2-3.4.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.5">image</dt>
        <dd style="margin-left: 1.5em" id="section-2-3.6">
          <p id="section-2-3.6.1">The source data from which a cryptographic digest is calculated.<a href="#section-2-3.6.1" class="pilcrow">¶</a></p>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="envelope-format-specification">
<section id="section-3">
      <h2 id="name-envelope-format-specificati">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-envelope-format-specificati" class="section-name selfRef">Envelope Format Specification</a>
      </h2>
<p id="section-3-1">This section is normative, and specifies the Gordian Envelope binary format in terms of its CBOR components and their sequencing. The formal language used is the Concise Data Definition Language (CDDL) <span>[<a href="#RFC8610" class="cite xref">RFC8610</a>]</span>. To be considered a well-formed Envelope, a sequence of bytes <span class="bcp14">MUST</span> conform to the Gordian dCBOR deterministic CBOR profile <span>[<a href="#DCBOR" class="cite xref">DCBOR</a>]</span> and <span class="bcp14">MUST</span> conform to the specifications in this section.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">An Envelope is a tagged enumerated type with five cases. Here is the entire CDDL specification for the base Envelope format. Each case is discussed in detail below:<a href="#section-3-2" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-3-3">
<pre>
envelope = #6.200(
    leaf /
    elided /
    node /
    assertion /
    wrapped
)

leaf = #6.24(bytes)  ; MUST be dCBOR

elided = sha256-digest
sha256-digest = bytes .size 32

node = [subject, + assertion-element]
subject = envelope
assertion-element = ( assertion / elided-assertion )
elided-assertion = elided           ; MUST represent an assertion.

assertion = { predicate-envelope: object-envelope }
predicate-envelope = envelope
object-envelope = envelope

wrapped = envelope
</pre><a href="#section-3-3" class="pilcrow">¶</a>
</div>
<p id="section-3-4">Some of these cases create a hierarchical, recursive structure by including children that are themselves Envelopes. Two of these cases (<code>leaf</code> and <code>elided</code>) have no children. The <code>node</code> case adds one or more assertions to the envelope, each of which is a child. The <code>assertion</code> case is a predicate/object pair, both of which are children. The <code>wrapped</code> case is used to wrap an entire Envelope including its assertions (its child) so assertions can be made about the wrapped Envelope as a whole.<a href="#section-3-4" class="pilcrow">¶</a></p>
<div id="leaf-case-format">
<section id="section-3.1">
        <h3 id="name-leaf-case-format">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-leaf-case-format" class="section-name selfRef">Leaf Case Format</a>
        </h3>
<p id="section-3.1-1">A <code>leaf</code> case is used when the Envelope contains only user-defined CBOR content. It is tagged using <code>#6.24</code>, per <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span> §3.4.5.1, "Encoded CBOR Data Item".<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-3.1-2">
<pre>
leaf = #6.24(bytes)  ; MUST be dCBOR
</pre><a href="#section-3.1-2" class="pilcrow">¶</a>
</div>
<p id="section-3.1-3">The <code>leaf</code> case can be discriminated from other Envelope case arms by the fact that it is the only one that is tagged using <code>#6.24</code>.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<p id="section-3.1-4">To preserve deterministic encoding, authors of application-level data formats based on Envelope <span class="bcp14">MUST</span> only encode CBOR in the <code>leaf</code> case that conforms to dCBOR <span>[<a href="#DCBOR" class="cite xref">DCBOR</a>]</span>. Care must be taken to ensure that leaf CBOR follows best practices for deterministic encoding, such as clearly specifying when tags for nested structures <span class="bcp14">MUST</span> or <span class="bcp14">MUST NOT</span> be used.<a href="#section-3.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="elided-case-format">
<section id="section-3.2">
        <h3 id="name-elided-case-format">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-elided-case-format" class="section-name selfRef">Elided Case Format</a>
        </h3>
<p id="section-3.2-1">An <code>elided</code> case is used as a placeholder for an element that has been elided. It consists solely of the elided envelope's digest.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-3.2-2">
<pre>
elided = sha256-digest
sha256-digest = bytes .size 32
</pre><a href="#section-3.2-2" class="pilcrow">¶</a>
</div>
<p id="section-3.2-3">The <code>elided</code> case can be discriminated from other Envelope case arms by the fact that it is the only one that is a CBOR byte string and always has a length of 32 bytes.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="node-case-format">
<section id="section-3.3">
        <h3 id="name-node-case-format">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-node-case-format" class="section-name selfRef">Node Case Format</a>
        </h3>
<p id="section-3.3-1">A <code>node</code> case is encoded as a CBOR array. A <code>node</code> case <span class="bcp14">MUST</span> be used when one or more assertions are present on the Envelope. A <code>node</code> case <span class="bcp14">MUST NOT</span> be present when there is not at least one assertion.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">The first element of the array is the Envelope's <code>subject</code>, followed by one or more <code>assertion-element</code>s, each of which <span class="bcp14">MUST</span> either be an <code>assertion</code> or an <code>elided-assertion</code>.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<p id="section-3.3-3">The <code>assertion-element</code>s <span class="bcp14">MUST</span> appear in ascending lexicographic order by their digest (not to be confused with sorting a CBOR map's keys).<a href="#section-3.3-3" class="pilcrow">¶</a></p>
<p id="section-3.3-4">The array <span class="bcp14">MUST NOT</span> contain any <code>assertion-element</code>s with identical digests.<a href="#section-3.3-4" class="pilcrow">¶</a></p>
<p id="section-3.3-5">For an Envelope to be valid, any <code>elided-assertion</code> Envelopes in the <code>node</code> assertions <span class="bcp14">MUST</span>, if and when unelided, be found to be actual <code>assertion</code> case Envelopes having the same digest.<a href="#section-3.3-5" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-3.3-6">
<pre>
node = [subject, + assertion-element]
subject = envelope
assertion-element = ( assertion / elided-assertion )
elided-assertion = elided           ; MUST represent an assertion.
</pre><a href="#section-3.3-6" class="pilcrow">¶</a>
</div>
<p id="section-3.3-7">The <code>node</code> case can be discriminated from other Envelope case arms by the fact that it is the only one that is a CBOR array.<a href="#section-3.3-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="assertion-case-format">
<section id="section-3.4">
        <h3 id="name-assertion-case-format">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-assertion-case-format" class="section-name selfRef">Assertion Case Format</a>
        </h3>
<p id="section-3.4-1">An <code>assertion</code> case is used for each of the assertions on the subject of an Envelope. It is encoded as a CBOR map with exactly one map element:<a href="#section-3.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.4-2.1">The key of the map element is the Envelope representing the predicate of the assertion.<a href="#section-3.4-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.4-2.2">The value of the map element is the Envelope representing the object of the assertion.<a href="#section-3.4-2.2" class="pilcrow">¶</a>
</li>
        </ul>
<div class="lang-cddl sourcecode" id="section-3.4-3">
<pre>
assertion = { predicate-envelope: object-envelope }
predicate-envelope = envelope
object-envelope = envelope
</pre><a href="#section-3.4-3" class="pilcrow">¶</a>
</div>
<p id="section-3.4-4">The <code>assertion</code> case can be discriminated from other Envelope case arms by the fact that it is the only one that is a CBOR map.<a href="#section-3.4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="wrapped-case-format">
<section id="section-3.5">
        <h3 id="name-wrapped-case-format">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-wrapped-case-format" class="section-name selfRef">Wrapped Case Format</a>
        </h3>
<p id="section-3.5-1">Assertions make semantic statements about an Envelope's subject. A <code>wrapped</code> case is used where an Envelope, including all its assertions, should be treated as a single element, e.g. for the purpose of adding assertions to an Envelope as a whole, including its assertions.<a href="#section-3.5-1" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-3.5-2">
<pre>
wrapped = envelope
</pre><a href="#section-3.5-2" class="pilcrow">¶</a>
</div>
<p id="section-3.5-3">The <code>wrapped</code> case can be discriminated from other Envelope case arms by the fact that it is the only one that is a CBOR envelope, and is always tagged with <code>#6.200</code>.<a href="#section-3.5-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="computing-the-digest-tree">
<section id="section-4">
      <h2 id="name-computing-the-digest-tree">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-computing-the-digest-tree" class="section-name selfRef">Computing the Digest Tree</a>
      </h2>
<p id="section-4-1">This section specifies how the digests for each of the Envelope cases are computed, and is normative. The examples in this section may be used as test vectors.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">Each of the five enumerated Envelope cases produces an image which is used as input to a cryptographic hash function to produce the digest of its contents.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">The overall digest of an Envelope is the digest of its specific case.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">In this section:<a href="#section-4-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-5.1">
          <code>digest(image)</code> is the 32-byte hash produced by running the SHA-256 hash function on the input image.<a href="#section-4-5.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-5.2">The <code>.digest</code> attribute is the digest of the named element computed as specified herein.<a href="#section-4-5.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-5.3">The <code>||</code> operator represents the concatenation of byte sequences.<a href="#section-4-5.3" class="pilcrow">¶</a>
</li>
      </ul>
<div id="leaf-digest-calculation">
<section id="section-4.1">
        <h3 id="name-leaf-digest-calculation">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-leaf-digest-calculation" class="section-name selfRef">Leaf Digest Calculation</a>
        </h3>
<p id="section-4.1-1">The <code>leaf</code> case consists of any CBOR object conforming to dCBOR <span>[<a href="#DCBOR" class="cite xref">DCBOR</a>]</span>. The Envelope image is the CBOR serialization of that object:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-2">
<pre>
digest(cbor)
</pre><a href="#section-4.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1-3"><strong>Example</strong><a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">The CBOR serialization of the plaintext string <code>"Hello"</code> (not including the quotes) is <code>6548656C6C6F</code>. The following command line calculates the SHA-256 sum of this sequence:<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-5">
<pre>
$ echo "6548656C6C6F" | xxd -r -p | shasum --binary --algorithm 256 | \
    awk '{ print $1 }'
4d303dac9eed63573f6190e9c4191be619e03a7b3c21e9bb3d27ac1a55971e6b
</pre><a href="#section-4.1-5" class="pilcrow">¶</a>
</div>
<p id="section-4.1-6">Using the <code>envelope</code> command line tool <span>[<a href="#ENVELOPE-CLI" class="cite xref">ENVELOPE-CLI</a>]</span>, we create an Envelope with this string as the subject and display the Envelope's digest. The digest below matches the one above.<a href="#section-4.1-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-7">
<pre>
$ envelope subject "Hello" | envelope digest --hex
4d303dac9eed63573f6190e9c4191be619e03a7b3c21e9bb3d27ac1a55971e6b
</pre><a href="#section-4.1-7" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="elided-digest-calculation">
<section id="section-4.2">
        <h3 id="name-elided-digest-calculation">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-elided-digest-calculation" class="section-name selfRef">Elided Digest Calculation</a>
        </h3>
<p id="section-4.2-1">The <code>elided</code> case declares its digest to be the digest of the Envelope for which it is a placeholder.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2"><strong>Example</strong><a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">If we create the Envelope from the leaf example above, elide it, and then request its digest:<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2-4">
<pre>
$ envelope subject "Hello" | envelope elide | envelope digest --hex
4d303dac9eed63573f6190e9c4191be619e03a7b3c21e9bb3d27ac1a55971e6b
</pre><a href="#section-4.2-4" class="pilcrow">¶</a>
</div>
<p id="section-4.2-5">...we see that its digest is the same as its unelided form:<a href="#section-4.2-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2-6">
<pre>
$ envelope subject "Hello" | envelope digest --hex
4d303dac9eed63573f6190e9c4191be619e03a7b3c21e9bb3d27ac1a55971e6b
</pre><a href="#section-4.2-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="node-digest-calculation">
<section id="section-4.3">
        <h3 id="name-node-digest-calculation">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-node-digest-calculation" class="section-name selfRef">Node Digest Calculation</a>
        </h3>
<p id="section-4.3-1">The Envelope image of the <code>node</code> case is the concatenation of the digest of its <code>subject</code> and the digests of its assertions sorted in ascending lexicographic order.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">With a <code>node</code> case, there <span class="bcp14">MUST</span> always be at least one assertion.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3-3">
<pre>
digest(subject.digest || assertion-0.digest ||
    assertion-1.digest || ... || assertion-n.digest)
</pre><a href="#section-4.3-3" class="pilcrow">¶</a>
</div>
<p id="section-4.3-4"><strong>Example</strong><a href="#section-4.3-4" class="pilcrow">¶</a></p>
<p id="section-4.3-5">We create four separate Envelopes and display their digests:<a href="#section-4.3-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3-6">
<pre>
$ SUBJECT=`envelope subject "Alice"`
$ envelope digest --hex $SUBJECT
13941b487c1ddebce827b6ec3f46d982938acdc7e3b6a140db36062d9519dd2f

$ ASSERTION_0=`envelope subject assertion "knows" "Bob"`
$ envelope digest --hex $ASSERTION_0
78d666eb8f4c0977a0425ab6aa21ea16934a6bc97c6f0c3abaefac951c1714a2

$ ASSERTION_1=`envelope subject assertion "knows" "Carol"`
$ envelope digest --hex $ASSERTION_1
4012caf2d96bf3962514bcfdcf8dd70c351735dec72c856ec5cdcf2ee35d6a91

$ ASSERTION_2=`envelope subject assertion "knows" "Edward"`
$ envelope digest --hex $ASSERTION_2
65c3ebc3f056151a6091e738563dab4af8da1778da5a02afcd104560b612ca17
</pre><a href="#section-4.3-6" class="pilcrow">¶</a>
</div>
<p id="section-4.3-7">We combine the Envelopes into a single Envelope with three assertions:<a href="#section-4.3-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3-8">
<pre>
$ ENVELOPE=`envelope assertion add envelope $ASSERTION_0 $SUBJECT | \
    envelope assertion add envelope $ASSERTION_1 | \
    envelope assertion add envelope $ASSERTION_2`

$ envelope $ENVELOPE
"Alice" [
    "knows": "Bob"
    "knows": "Carol"
    "knows": "Edward"
]

$ envelope digest --hex $ENVELOPE
6255e3b67ad935caf07b5dce5105d913dcfb82f0392d4d302f6d406e85ab4769
</pre><a href="#section-4.3-8" class="pilcrow">¶</a>
</div>
<p id="section-4.3-9">Note that in the Envelope notation representation above, the assertions are sorted alphabetically, with <code>"knows": "Edward"</code> coming last. But internally, the three assertions are ordered by digest in ascending lexicographic order, with "Carol" coming first because its digest starting with <code>4012caf2</code> is the lowest, as in the tree formatted display below:<a href="#section-4.3-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3-10">
<pre>
$ envelope --tree $ENVELOPE
6255e3b6 NODE
    13941b48 subj "Alice"
    4012caf2 ASSERTION
        db7dd21c pred "knows"
        afb8122e obj "Carol"
    65c3ebc3 ASSERTION
        db7dd21c pred "knows"
        e9af7883 obj "Edward"
    78d666eb ASSERTION
        db7dd21c pred "knows"
        13b74194 obj "Bob"
</pre><a href="#section-4.3-10" class="pilcrow">¶</a>
</div>
<p id="section-4.3-11">To replicate this, we make a list of digests, starting with the subject, and then each assertion's digest in ascending lexicographic order:<a href="#section-4.3-11" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3-12">
<pre>
13941b487c1ddebce827b6ec3f46d982938acdc7e3b6a140db36062d9519dd2f
4012caf2d96bf3962514bcfdcf8dd70c351735dec72c856ec5cdcf2ee35d6a91
65c3ebc3f056151a6091e738563dab4af8da1778da5a02afcd104560b612ca17
78d666eb8f4c0977a0425ab6aa21ea16934a6bc97c6f0c3abaefac951c1714a2
</pre><a href="#section-4.3-12" class="pilcrow">¶</a>
</div>
<p id="section-4.3-13">We then calculate the SHA-256 digest of the concatenation of these four digests. Note that this is the same digest as the composite Envelope's digest:<a href="#section-4.3-13" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3-14">
<pre>
echo "13941b487c1ddebce827b6ec3f46d982938acdc7e3b6a140db36062d9519dd2f\
4012caf2d96bf3962514bcfdcf8dd70c351735dec72c856ec5cdcf2ee35d6a91\
65c3ebc3f056151a6091e738563dab4af8da1778da5a02afcd104560b612ca17\
78d666eb8f4c0977a0425ab6aa21ea16934a6bc97c6f0c3abaefac951c1714a2" | \
    xxd -r -p | shasum --binary --algorithm 256 | awk '{ print $1 }'
6255e3b67ad935caf07b5dce5105d913dcfb82f0392d4d302f6d406e85ab4769

$ envelope digest --hex $ENVELOPE
6255e3b67ad935caf07b5dce5105d913dcfb82f0392d4d302f6d406e85ab4769
</pre><a href="#section-4.3-14" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="assertion-digest-calculation">
<section id="section-4.4">
        <h3 id="name-assertion-digest-calculatio">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-assertion-digest-calculatio" class="section-name selfRef">Assertion Digest Calculation</a>
        </h3>
<p id="section-4.4-1">The Envelope image of the <code>assertion</code> case is the concatenation of the digests of the assertion's predicate and object, in that order:<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4-2">
<pre>
digest(predicate.digest || object.digest)
</pre><a href="#section-4.4-2" class="pilcrow">¶</a>
</div>
<p id="section-4.4-3"><strong>Example</strong><a href="#section-4.4-3" class="pilcrow">¶</a></p>
<p id="section-4.4-4">We create an assertion from two separate Envelopes and display their digests:<a href="#section-4.4-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4-5">
<pre>
$ PREDICATE=`envelope subject "knows"`
$ envelope digest --hex $PREDICATE
db7dd21c5169b4848d2a1bcb0a651c9617cdd90bae29156baaefbb2a8abef5ba

$ OBJECT=`envelope subject "Bob"`
$ envelope digest --hex $OBJECT
13b741949c37b8e09cc3daa3194c58e4fd6b2f14d4b1d0f035a46d6d5a1d3f11

$ ASSERTION=`envelope subject assertion "knows" "Bob"`
$ envelope digest --hex $ASSERTION
78d666eb8f4c0977a0425ab6aa21ea16934a6bc97c6f0c3abaefac951c1714a2
</pre><a href="#section-4.4-5" class="pilcrow">¶</a>
</div>
<p id="section-4.4-6">To replicate this, we make a list of the predicate digest and the object digest, in that order:<a href="#section-4.4-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4-7">
<pre>
db7dd21c5169b4848d2a1bcb0a651c9617cdd90bae29156baaefbb2a8abef5ba
13b741949c37b8e09cc3daa3194c58e4fd6b2f14d4b1d0f035a46d6d5a1d3f11
</pre><a href="#section-4.4-7" class="pilcrow">¶</a>
</div>
<p id="section-4.4-8">We then calculate the SHA-256 digest of the concatenation of these two digests. Note that this is the same digest as the composite Envelope's digest:<a href="#section-4.4-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4-9">
<pre>
echo "db7dd21c5169b4848d2a1bcb0a651c9617cdd90bae29156baaefbb2a8abef5ba\
13b741949c37b8e09cc3daa3194c58e4fd6b2f14d4b1d0f035a46d6d5a1d3f11" | \
    xxd -r -p | shasum --binary --algorithm 256 | awk '{ print $1 }'
78d666eb8f4c0977a0425ab6aa21ea16934a6bc97c6f0c3abaefac951c1714a2

$ envelope digest --hex $ASSERTION
78d666eb8f4c0977a0425ab6aa21ea16934a6bc97c6f0c3abaefac951c1714a2
</pre><a href="#section-4.4-9" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="wrapped-digest-calculation">
<section id="section-4.5">
        <h3 id="name-wrapped-digest-calculation">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-wrapped-digest-calculation" class="section-name selfRef">Wrapped Digest Calculation</a>
        </h3>
<p id="section-4.5-1">The Envelope image of the <code>wrapped</code> case is the digest of the wrapped Envelope:<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5-2">
<pre>
digest(envelope.digest)
</pre><a href="#section-4.5-2" class="pilcrow">¶</a>
</div>
<p id="section-4.5-3"><strong>Example</strong><a href="#section-4.5-3" class="pilcrow">¶</a></p>
<p id="section-4.5-4">As above, we note the digest of a leaf Envelope is the digest of its CBOR:<a href="#section-4.5-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5-5">
<pre>
$ envelope subject "Hello" | envelope digest --hex
4d303dac9eed63573f6190e9c4191be619e03a7b3c21e9bb3d27ac1a55971e6b

$ echo "6548656C6C6F" | xxd -r -p | shasum --binary --algorithm 256 | \
    awk '{ print $1 }'
4d303dac9eed63573f6190e9c4191be619e03a7b3c21e9bb3d27ac1a55971e6b
</pre><a href="#section-4.5-5" class="pilcrow">¶</a>
</div>
<p id="section-4.5-6">Now we note that the digest of a wrapped Envelope is the digest of the wrapped Envelope's digest:<a href="#section-4.5-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5-7">
<pre>
$ envelope subject "Hello" | \
    envelope subject --wrapped | \
    envelope digest --hex
743a86a9f411b1441215fbbd3ece3de5206810e8a3dd8239182e123802677bd7

$ echo "4d303dac9eed63573f6190e9c4191be619e03a7b3c21e9bb\
3d27ac1a55971e6b" \
    | xxd -r -p | shasum --binary --algorithm 256 | awk '{ print $1 }'
743a86a9f411b1441215fbbd3ece3de5206810e8a3dd8239182e123802677bd7
</pre><a href="#section-4.5-7" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="envelope-hierarchy">
<section id="section-5">
      <h2 id="name-envelope-hierarchy">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-envelope-hierarchy" class="section-name selfRef">Envelope Hierarchy</a>
      </h2>
<p id="section-5-1">This section is informative, and describes Envelopes from the perspective of their hierarchical structure and the various ways they can be formatted.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">Notionally an Envelope can be thought of as a <code>subject</code> and one or more <code>predicate-object</code> pairs called <code>assertions</code>.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">Note that the following example is <em>not</em> CDDL or CBOR diagnostic notation, but "Envelope notation," which is a convenient way to describe the structure of an Envelope:<a href="#section-5-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5-4">
<pre>
subject [
    predicate0: object0
    predicate1: object1
    ...
    predicateN: objectN
]
</pre><a href="#section-5-4" class="pilcrow">¶</a>
</div>
<p id="section-5-5">A concrete example of this might be:<a href="#section-5-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5-6">
<pre>
"Alice" [
    "knows": "Bob"
    "knows": "Carol"
    "knows": "Edward"
]
</pre><a href="#section-5-6" class="pilcrow">¶</a>
</div>
<p id="section-5-7">The notional concept of Envelope is helpful, but not technically accurate because Envelope is implemented structurally as an enumerated type consisting of five cases. This allows actual Envelope instances to be more flexible, for example a "bare assertion" consisting of a predicate-object pair with no subject, which is useful in some situations:<a href="#section-5-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5-8">
<pre>
"knows": "Bob"
</pre><a href="#section-5-8" class="pilcrow">¶</a>
</div>
<p id="section-5-9">More common is the opposite case: a subject with no assertions:<a href="#section-5-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5-10">
<pre>
"Alice"
</pre><a href="#section-5-10" class="pilcrow">¶</a>
</div>
<p id="section-5-11">In Envelopes, there are five distinct "positions" of elements, each of which is itself an Envelope and which therefore produces its own digest:<a href="#section-5-11" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5-12">
<li id="section-5-12.1">envelope<a href="#section-5-12.1" class="pilcrow">¶</a>
</li>
        <li id="section-5-12.2">subject<a href="#section-5-12.2" class="pilcrow">¶</a>
</li>
        <li id="section-5-12.3">assertion<a href="#section-5-12.3" class="pilcrow">¶</a>
</li>
        <li id="section-5-12.4">predicate<a href="#section-5-12.4" class="pilcrow">¶</a>
</li>
        <li id="section-5-12.5">object<a href="#section-5-12.5" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-5-13">The examples above are printed in Envelope notation, which is designed to make the semantic content of Envelopes human-readable, but it doesn't show the actual digests associated with each of the positions. To see the structure more completely, we can display every element of the Envelope in "Tree Format":<a href="#section-5-13" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5-14">
<pre>
6255e3b6 NODE
    13941b48 subj "Alice"
    4012caf2 ASSERTION
        db7dd21c pred "knows"
        afb8122e obj "Carol"
    65c3ebc3 ASSERTION
        db7dd21c pred "knows"
        e9af7883 obj "Edward"
    78d666eb ASSERTION
        db7dd21c pred "knows"
        13b74194 obj "Bob"
</pre><a href="#section-5-14" class="pilcrow">¶</a>
</div>
<p id="section-5-15">For easy recognition, Envelope trees only show the first four bytes of each digest, but internally all digests are 32 bytes.<a href="#section-5-15" class="pilcrow">¶</a></p>
<p id="section-5-16">From the above Envelope and its tree, we make the following observations:<a href="#section-5-16" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-17.1">The Envelope is a <code>node</code> case, which has the overall Envelope digest.<a href="#section-5-17.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-17.2">The subject "Alice" has its own digest.<a href="#section-5-17.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-17.3">Each of the three assertions have their own digests<a href="#section-5-17.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-17.4">The predicate and object of each assertion each have their own digests.<a href="#section-5-17.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-17.5">The assertions appear in the structure in ascending lexicographic order by digest, which is the actual order in which they are serialized, and which is distinct from Envelope notation, where they appear sorted alphabetically.<a href="#section-5-17.5" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-5-18">The following subsections present each of the five enumerated Envelope cases in four different output formats:<a href="#section-5-18" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-19.1">Envelope Notation<a href="#section-5-19.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-19.2">Envelope Tree<a href="#section-5-19.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-19.3">CBOR Diagnostic Notation<a href="#section-5-19.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-19.4">CBOR hex<a href="#section-5-19.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-5-20">These examples may be used as test vectors. In addition, each subsection starts with the <code>envelope</code> command line <span>[<a href="#ENVELOPE-CLI" class="cite xref">ENVELOPE-CLI</a>]</span> needed to generate the Envelope being formatted.<a href="#section-5-20" class="pilcrow">¶</a></p>
<div id="leaf-case">
<section id="section-5.1">
        <h3 id="name-leaf-case">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-leaf-case" class="section-name selfRef">Leaf Case</a>
        </h3>
<p id="section-5.1-1"><strong>Envelope CLI Command Line</strong><a href="#section-5.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-2">
<pre>
envelope subject "Alice"
</pre><a href="#section-5.1-2" class="pilcrow">¶</a>
</div>
<p id="section-5.1-3"><strong>Envelope Notation</strong><a href="#section-5.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-4">
<pre>
"Alice"
</pre><a href="#section-5.1-4" class="pilcrow">¶</a>
</div>
<p id="section-5.1-5"><strong>Tree</strong><a href="#section-5.1-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-6">
<pre>
13941b48 "Alice"
</pre><a href="#section-5.1-6" class="pilcrow">¶</a>
</div>
<p id="section-5.1-7"><strong>CBOR Diagnostic Notation</strong><a href="#section-5.1-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-8">
<pre>
200(   ; envelope
   24("Alice")   ; leaf
)
</pre><a href="#section-5.1-8" class="pilcrow">¶</a>
</div>
<p id="section-5.1-9"><strong>CBOR Hex</strong><a href="#section-5.1-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-10">
<pre>
d8c8d81865416c696365
</pre><a href="#section-5.1-10" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="elided-case">
<section id="section-5.2">
        <h3 id="name-elided-case">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-elided-case" class="section-name selfRef">Elided Case</a>
        </h3>
<p id="section-5.2-1"><strong>Envelope CLI Command Line</strong><a href="#section-5.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-2">
<pre>
envelope subject "Alice" | envelope elide
</pre><a href="#section-5.2-2" class="pilcrow">¶</a>
</div>
<p id="section-5.2-3"><strong>Envelope Notation</strong><a href="#section-5.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-4">
<pre>
ELIDED
</pre><a href="#section-5.2-4" class="pilcrow">¶</a>
</div>
<p id="section-5.2-5"><strong>Tree</strong><a href="#section-5.2-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-6">
<pre>
13941b48 ELIDED
</pre><a href="#section-5.2-6" class="pilcrow">¶</a>
</div>
<p id="section-5.2-7"><strong>CBOR Diagnostic Notation</strong><a href="#section-5.2-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-8">
<pre>
200(   ; envelope
   h'13941b487c1ddebce827b6ec3f46d982938acdc7e3b6a140db36062d9519dd2f'
)
</pre><a href="#section-5.2-8" class="pilcrow">¶</a>
</div>
<p id="section-5.2-9"><strong>CBOR Hex</strong><a href="#section-5.2-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-10">
<pre>
d8c8582013941b487c1ddebce827b6ec3f46d982938acdc7e3b6a140db36062d9519dd2f
</pre><a href="#section-5.2-10" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="node-case">
<section id="section-5.3">
        <h3 id="name-node-case">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-node-case" class="section-name selfRef">Node Case</a>
        </h3>
<p id="section-5.3-1"><strong>Envelope CLI Command Line</strong><a href="#section-5.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-2">
<pre>
envelope subject "Alice" | envelope assertion "knows" "Bob"
</pre><a href="#section-5.3-2" class="pilcrow">¶</a>
</div>
<p id="section-5.3-3"><strong>Envelope Notation</strong><a href="#section-5.3-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-4">
<pre>
"Alice" [
    "knows": "Bob"
]
</pre><a href="#section-5.3-4" class="pilcrow">¶</a>
</div>
<p id="section-5.3-5"><strong>Tree</strong><a href="#section-5.3-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-6">
<pre>
8955db5e NODE
    13941b48 subj "Alice"
    78d666eb ASSERTION
        db7dd21c pred "knows"
        13b74194 obj "Bob"
</pre><a href="#section-5.3-6" class="pilcrow">¶</a>
</div>
<p id="section-5.3-7"><strong>CBOR Diagnostic Notation</strong><a href="#section-5.3-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-8">
<pre>
200(   ; envelope
   [
      200(   ; envelope
         24("Alice")   ; leaf
      ),
      200(   ; envelope
         {
            200(   ; envelope
               24("knows")   ; leaf
            ):
            200(   ; envelope
               24("Bob")   ; leaf
            )
         }
      )
   ]
)
</pre><a href="#section-5.3-8" class="pilcrow">¶</a>
</div>
<p id="section-5.3-9"><strong>CBOR Hex</strong><a href="#section-5.3-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-10">
<pre>
d8c882d8c8d81865416c696365d8c8a1d8c8d818656b6e6f7773d8c8d81863426f62
</pre><a href="#section-5.3-10" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="assertion-case">
<section id="section-5.4">
        <h3 id="name-assertion-case">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-assertion-case" class="section-name selfRef">Assertion Case</a>
        </h3>
<p id="section-5.4-1"><strong>Envelope CLI Command Line</strong><a href="#section-5.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4-2">
<pre>
envelope subject assertion "knows" "Bob"
</pre><a href="#section-5.4-2" class="pilcrow">¶</a>
</div>
<p id="section-5.4-3"><strong>Envelope Notation</strong><a href="#section-5.4-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4-4">
<pre>
"knows": "Bob"
</pre><a href="#section-5.4-4" class="pilcrow">¶</a>
</div>
<p id="section-5.4-5"><strong>Tree</strong><a href="#section-5.4-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4-6">
<pre>
78d666eb ASSERTION
    db7dd21c pred "knows"
    13b74194 obj "Bob"
</pre><a href="#section-5.4-6" class="pilcrow">¶</a>
</div>
<p id="section-5.4-7"><strong>CBOR Diagnostic Notation</strong><a href="#section-5.4-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4-8">
<pre>
200(   ; envelope
   {
      200(   ; envelope
         24("knows")   ; leaf
      ):
      200(   ; envelope
         24("Bob")   ; leaf
      )
   }
)
</pre><a href="#section-5.4-8" class="pilcrow">¶</a>
</div>
<p id="section-5.4-9"><strong>CBOR Hex</strong><a href="#section-5.4-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4-10">
<pre>
d8c8a1d8c8d818656b6e6f7773d8c8d81863426f62
</pre><a href="#section-5.4-10" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="wrapped-case">
<section id="section-5.5">
        <h3 id="name-wrapped-case">
<a href="#section-5.5" class="section-number selfRef">5.5. </a><a href="#name-wrapped-case" class="section-name selfRef">Wrapped Case</a>
        </h3>
<p id="section-5.5-1"><strong>Envelope CLI Command Line</strong><a href="#section-5.5-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5-2">
<pre>
envelope subject "Alice" | envelope subject --wrapped
</pre><a href="#section-5.5-2" class="pilcrow">¶</a>
</div>
<p id="section-5.5-3"><strong>Envelope Notation</strong><a href="#section-5.5-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5-4">
<pre>
{
    "Alice"
}
</pre><a href="#section-5.5-4" class="pilcrow">¶</a>
</div>
<p id="section-5.5-5"><strong>Tree</strong><a href="#section-5.5-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5-6">
<pre>
2bc17c65 WRAPPED
    13941b48 subj "Alice"
</pre><a href="#section-5.5-6" class="pilcrow">¶</a>
</div>
<p id="section-5.5-7"><strong>CBOR Diagnostic Notation</strong><a href="#section-5.5-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5-8">
<pre>
200(   ; envelope
   200(   ; envelope
      24("Alice")   ; leaf
   )
)
</pre><a href="#section-5.5-8" class="pilcrow">¶</a>
</div>
<p id="section-5.5-9"><strong>CBOR Hex</strong><a href="#section-5.5-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5-10">
<pre>
d8c8d8c8d81865416c696365
</pre><a href="#section-5.5-10" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="reference-implementations">
<section id="section-6">
      <h2 id="name-reference-implementations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-reference-implementations" class="section-name selfRef">Reference Implementations</a>
      </h2>
<p id="section-6-1">This section is informative.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">The current reference implementations of Envelope are written in Swift <span>[<a href="#ENVELOPE-SWIFT" class="cite xref">ENVELOPE-SWIFT</a>]</span> and Rust <span>[<a href="#ENVELOPE-RUST" class="cite xref">ENVELOPE-RUST</a>]</span>.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">The <code>envelope</code> command line tool <span>[<a href="#ENVELOPE-CLI" class="cite xref">ENVELOPE-CLI</a>]</span> is also written in Swift.<a href="#section-6-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-7-1">This section is informative unless noted otherwise.<a href="#section-7-1" class="pilcrow">¶</a></p>
<div id="cbor-considerations">
<section id="section-7.1">
        <h3 id="name-cbor-considerations">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-cbor-considerations" class="section-name selfRef">CBOR Considerations</a>
        </h3>
<p id="section-7.1-1">Generally, this document inherits the security considerations of CBOR <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span>. Though CBOR has limited web usage, it has received strong usage in hardware, resulting in a mature specification. It also inherits the security considerations of Gordian dCBOR <span>[<a href="#DCBOR" class="cite xref">DCBOR</a>]</span>.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="validation-requirements">
<section id="section-7.2">
        <h3 id="name-validation-requirements">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-validation-requirements" class="section-name selfRef">Validation Requirements</a>
        </h3>
<p id="section-7.2-1">Unlike HTML, Envelope is intended to be conservative in both what it encodes <em>and</em> what it accepts as valid. This means that receivers of Envelope-based documents should carefully validate them. Any deviation from the validation requirements of this specification <span class="bcp14">MUST</span> result in the rejection of the entire Envelope. Even after validation, Envelope contents should be treated with due skepticism at the application level.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="choice-of-sha-256-hash-primitive">
<section id="section-7.3">
        <h3 id="name-choice-of-sha-256-hash-prim">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-choice-of-sha-256-hash-prim" class="section-name selfRef">Choice of SHA-256 Hash Primitive</a>
        </h3>
<p id="section-7.3-1">Envelope uses the SHA-256 digest algorithm <span>[<a href="#RFC6234" class="cite xref">RFC6234</a>]</span>, which is regarded as reliable and widely supported by many implementations in both software and hardware.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="correlated-digests">
<section id="section-7.4">
        <h3 id="name-correlated-digests">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-correlated-digests" class="section-name selfRef">Correlated Digests</a>
        </h3>
<p id="section-7.4-1">Elided Envelopes may in some cases inadvertently reveal information by transmitting digests that may be correlated to known information. In many cases this is of no consequence, but when necessary Envelopes can (when constructed) be "salted" by adding assertions that contain random data. This results in perturbing the digest tree, hence decorrelating it (after elision) from digests whose unelided contents are known.<a href="#section-7.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="rfc-6973-considerations">
<section id="section-7.5">
        <h3 id="name-rfc-6973-considerations">
<a href="#section-7.5" class="section-number selfRef">7.5. </a><a href="#name-rfc-6973-considerations" class="section-name selfRef">RFC-6973 Considerations</a>
        </h3>
<p id="section-7.5-1">"Privacy Considerations for Internet Protocols" <span>[<a href="#RFC6973" class="cite xref">RFC6973</a>]</span> lists threats and guidelines related to privacy in internet protocols. Envelope is intended to help internet protocols easily adopt these considerations. It explicitly addresses the privacy-specific threats of correlation, secondary use, and disclosure by supporting the suggested guideline of Data Minimization.<a href="#section-7.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="rfc-8280-considerations">
<section id="section-7.6">
        <h3 id="name-rfc-8280-considerations">
<a href="#section-7.6" class="section-number selfRef">7.6. </a><a href="#name-rfc-8280-considerations" class="section-name selfRef">RFC-8280 Considerations</a>
        </h3>
<p id="section-7.6-1">"Research into Human Rights Protocol Considerations" <span>[<a href="#RFC8280" class="cite xref">RFC8280</a>]</span> lists guidelines for human rights considerations in internet protocols. Envelope similarly adopts many of the guidelines there, improving privacy and censorship resistance through its hashed elision; and accessibility, heterogeneity support, reliability, and integrity through its fundamental data structures.<a href="#section-7.6-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<div id="cbor-tags">
<section id="section-8.1">
        <h3 id="name-cbor-tags">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-cbor-tags" class="section-name selfRef">CBOR Tags</a>
        </h3>
<p id="section-8.1-1">This document requests that IANA <span>[<a href="#IANA-CBOR-TAGS" class="cite xref">IANA-CBOR-TAGS</a>]</span> reserve the following tag:<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
          <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Tag</th>
              <th class="text-left" rowspan="1" colspan="1">Data Item</th>
              <th class="text-left" rowspan="1" colspan="1">Semantics</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">200</td>
              <td class="text-left" rowspan="1" colspan="1">multiple</td>
              <td class="text-left" rowspan="1" colspan="1">Gordian Envelope</td>
            </tr>
          </tbody>
        </table>
<p id="section-8.1-3">Points of contact:<a href="#section-8.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1-4.1">Christopher Allen <a href="mailto:christophera@blockchaincommons.com">christophera@blockchaincommons.com</a><a href="#section-8.1-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.1-4.2">Wolf McNally <a href="mailto:wolf@wolfmcnally.com">wolf@wolfmcnally.com</a><a href="#section-8.1-4.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="media-type">
<section id="section-8.2">
        <h3 id="name-media-type">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-media-type" class="section-name selfRef">Media Type</a>
        </h3>
<p id="section-8.2-1">The proposed media type <span>[<a href="#RFC6838" class="cite xref">RFC6838</a>]</span> for Envelope is <code>application/envelope+cbor</code>. The authors understand that this will require this document to become an RFC before the media type can be registered.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2-2.1">Type name: application<a href="#section-8.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.2-2.2">Subtype name: envelope+cbor<a href="#section-8.2-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.2-2.3">Required parameters: n/a<a href="#section-8.2-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.2-2.4">Optional parameters: n/a<a href="#section-8.2-2.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.2-2.5">Encoding considerations: binary<a href="#section-8.2-2.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.2-2.6">Security considerations: See the previous section of this document<a href="#section-8.2-2.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.2-2.7">Interoperability considerations: n/a<a href="#section-8.2-2.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.2-2.8">Published specification: This document<a href="#section-8.2-2.8" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.2-2.9">Applications that use this media type:  None yet, but it is expected that this format will be deployed in protocols and applications.<a href="#section-8.2-2.9" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.2-2.10">
            <p id="section-8.2-2.10.1">Additional information:<a href="#section-8.2-2.10.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2-2.10.2.1">Magic number(s): n/a<a href="#section-8.2-2.10.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-8.2-2.10.2.2">File extension(s): .envelope<a href="#section-8.2-2.10.2.2" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-8.2-2.10.2.3">Macintosh file type code(s): n/a<a href="#section-8.2-2.10.2.3" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-8.2-2.11">
            <p id="section-8.2-2.11.1">Person &amp; email address to contact for further information:<a href="#section-8.2-2.11.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2-2.11.2.1">Christopher Allen <a href="mailto:christophera@blockchaincommons.com">christophera@blockchaincommons.com</a><a href="#section-8.2-2.11.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-8.2-2.11.2.2">Wolf McNally <a href="mailto:wolf@wolfmcnally.com">wolf@wolfmcnally.com</a><a href="#section-8.2-2.11.2.2" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-8.2-2.12">Intended usage: COMMON<a href="#section-8.2-2.12" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.2-2.13">Restrictions on usage: none<a href="#section-8.2-2.13" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.2-2.14">
            <p id="section-8.2-2.14.1">Author:<a href="#section-8.2-2.14.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2-2.14.2.1">Wolf McNally <a href="mailto:wolf@wolfmcnally.com">wolf@wolfmcnally.com</a><a href="#section-8.2-2.14.2.1" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-8.2-2.15">
            <p id="section-8.2-2.15.1">Change controller:<a href="#section-8.2-2.15.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2-2.15.2.1">The IESG <a href="mailto:iesg@ietf.org">iesg@ietf.org</a><a href="#section-8.2-2.15.2.1" class="pilcrow">¶</a>
</li>
            </ul>
</li>
        </ul>
</section>
</div>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="DCBOR">[DCBOR]</dt>
        <dd>
<span class="refTitle">"Gordian dCBOR: A Deterministic CBOR Application Profile"</span>, <span>n.d.</span>, <span>&lt;<a href="https://datatracker.ietf.org/doc/draft-mcnally-deterministic-cbor/">https://datatracker.ietf.org/doc/draft-mcnally-deterministic-cbor/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ENVELOPE-CLI">[ENVELOPE-CLI]</dt>
        <dd>
<span class="refTitle">"Envelope Command Line Tool"</span>, <span>n.d.</span>, <span>&lt;<a href="https://github.com/BlockchainCommons/envelope-cli-swift">https://github.com/BlockchainCommons/envelope-cli-swift</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ENVELOPE-RUST">[ENVELOPE-RUST]</dt>
        <dd>
<span class="refTitle">"Blockchain Commons Gordian Envelope for Rust"</span>, <span>n.d.</span>, <span>&lt;<a href="https://github.com/blockchaincommons/bc-envelope-rust">https://github.com/blockchaincommons/bc-envelope-rust</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ENVELOPE-SWIFT">[ENVELOPE-SWIFT]</dt>
        <dd>
<span class="refTitle">"Blockchain Commons Gordian Envelope for Swift"</span>, <span>n.d.</span>, <span>&lt;<a href="https://github.com/blockchaincommons/BCSwiftEnvelope">https://github.com/blockchaincommons/BCSwiftEnvelope</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IANA-CBOR-TAGS">[IANA-CBOR-TAGS]</dt>
        <dd>
<span class="refTitle">"IANA, Concise Binary Object Representation (CBOR) Tags"</span>, <span>n.d.</span>, <span>&lt;<a href="https://www.iana.org/assignments/cbor-tags/cbor-tags.xhtml">https://www.iana.org/assignments/cbor-tags/cbor-tags.xhtml</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6234">[RFC6234]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span> and <span class="refAuthor">T. Hansen</span>, <span class="refTitle">"US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)"</span>, <span class="seriesInfo">RFC 6234</span>, <span class="seriesInfo">DOI 10.17487/RFC6234</span>, <time datetime="2011-05" class="refDate">May 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6234">https://www.rfc-editor.org/rfc/rfc6234</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6838">[RFC6838]</dt>
        <dd>
<span class="refAuthor">Freed, N.</span>, <span class="refAuthor">Klensin, J.</span>, and <span class="refAuthor">T. Hansen</span>, <span class="refTitle">"Media Type Specifications and Registration Procedures"</span>, <span class="seriesInfo">BCP 13</span>, <span class="seriesInfo">RFC 6838</span>, <span class="seriesInfo">DOI 10.17487/RFC6838</span>, <time datetime="2013-01" class="refDate">January 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6838">https://www.rfc-editor.org/rfc/rfc6838</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8610">[RFC8610]</dt>
        <dd>
<span class="refAuthor">Birkholz, H.</span>, <span class="refAuthor">Vigano, C.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures"</span>, <span class="seriesInfo">RFC 8610</span>, <span class="seriesInfo">DOI 10.17487/RFC8610</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8610">https://www.rfc-editor.org/rfc/rfc8610</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8949">[RFC8949]</dt>
      <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8949">https://www.rfc-editor.org/rfc/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="MERKLE">[MERKLE]</dt>
        <dd>
<span class="refTitle">"Merkle Tree"</span>, <span>n.d.</span>, <span>&lt;<a href="https://en.wikipedia.org/wiki/Merkle_tree">https://en.wikipedia.org/wiki/Merkle_tree</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6973">[RFC6973]</dt>
        <dd>
<span class="refAuthor">Cooper, A.</span>, <span class="refAuthor">Tschofenig, H.</span>, <span class="refAuthor">Aboba, B.</span>, <span class="refAuthor">Peterson, J.</span>, <span class="refAuthor">Morris, J.</span>, <span class="refAuthor">Hansen, M.</span>, and <span class="refAuthor">R. Smith</span>, <span class="refTitle">"Privacy Considerations for Internet Protocols"</span>, <span class="seriesInfo">RFC 6973</span>, <span class="seriesInfo">DOI 10.17487/RFC6973</span>, <time datetime="2013-07" class="refDate">July 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6973">https://www.rfc-editor.org/rfc/rfc6973</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8280">[RFC8280]</dt>
      <dd>
<span class="refAuthor">ten Oever, N.</span> and <span class="refAuthor">C. Cath</span>, <span class="refTitle">"Research into Human Rights Protocol Considerations"</span>, <span class="seriesInfo">RFC 8280</span>, <span class="seriesInfo">DOI 10.17487/RFC8280</span>, <time datetime="2017-10" class="refDate">October 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8280">https://www.rfc-editor.org/rfc/rfc8280</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">TODO acknowledge.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Wolf McNally</span></div>
<div dir="auto" class="left"><span class="org">Blockchain Commons</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:wolf@wolfmcnally.com" class="email">wolf@wolfmcnally.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher Allen</span></div>
<div dir="auto" class="left"><span class="org">Blockchain Commons</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:christophera@lifewithalacrity.com" class="email">christophera@lifewithalacrity.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
